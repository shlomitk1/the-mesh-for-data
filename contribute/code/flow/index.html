<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Contribution Flow - Mesh for Data</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://ibm.github.io/the-mesh-for-data/favicon.png><link rel=stylesheet href=/the-mesh-for-data/css/style.min.3dea6367d70c56e79acec88bd5217c58299cb81f7dd3f7a663517f3f971ab627.css></head><body class="page page-default-single"><div id=main-menu-mobile class=main-menu-mobile><ul><li class=menu-item-home><a href=/the-mesh-for-data/><span>Home</span></a></li><li class=menu-item-docs><a href=/the-mesh-for-data/docs/><span>Docs</span></a></li><li class=menu-item-contribute><a href=/the-mesh-for-data/contribute/><span>Contribute</span></a></li></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=https://ibm.github.io/the-mesh-for-data/><img alt=Logo src=/the-mesh-for-data/images/logo.svg></a></div><div class=logo-mobile><a href=https://ibm.github.io/the-mesh-for-data/><img alt=Logo src=/the-mesh-for-data/images/logo.svg></a></div><div id=main-menu class=main-menu><ul><li class=menu-item-home><a href=/the-mesh-for-data/><span>Home</span></a></li><li class=menu-item-docs><a href=/the-mesh-for-data/docs/><span>Docs</span></a></li><li class=menu-item-contribute><a href=/the-mesh-for-data/contribute/><span>Contribute</span></a></li><li><a href=https://github.com/IBM/the-mesh-for-data style=color:#000 class=border-left><i class="fab fa-github fa-2x"></i></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pt-md-6 pb-3 pb-md-6"><div class=row><div class="col-12 col-md-3 mb-3"><div class="d-none d-lg-block"><nav id=sidebar aria-label="Section Navigation"><div class=directory><div class=card><button class="header dynamic" id=card4 title="Details how to contribute code changes." aria-controls=card4-body>Contributing Code</button><div class="body default" aria-labelledby=card4 role=region id=card4-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card4><li role=none><span role=treeitem class=current>Contribution Flow</span></li><li role=none><a role=treeitem href=https://ibm.github.io/the-mesh-for-data/contribute/code/devenv/>Development Environment</a></li></ul></div></div><div class=card><button class="header dynamic" id=card6 title="Details how to create and maintain documentation pages." aria-controls=card6-body>Contributing Docs</button><div class=body aria-labelledby=card6 role=region id=card6-body><ul role=tree aria-expanded=true aria-labelledby=card6><li role=none><a role=treeitem title=() href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/workflow/>Contribution Workflow</a></li><li role=treeitem aria-label="Write documentation"><button aria-hidden=true></button><a title="Details how to contribute new documentation ()" href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/>Write documentation</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Documentation syntax is Markdown with a few extras ()" href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/syntax/>Documentation Syntax</a></li><li role=none><a role=treeitem title="Explains the standard markup used to format documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/formatting/>Formatting Standards</a></li><li role=none><a role=treeitem title="Explains the style conventions used in the documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/style-guide/>Style Guide</a></li><li role=none><a role=treeitem title="Explains the terminology standards used in the documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/terminology/>Terminology Standards</a></li></ul></li><li role=none><a role=treeitem title="Explains how to locally build, test, serve, and preview the website." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/build/>Preview website locally</a></li></ul></div></div><div class=card><button class="header dynamic" id=card8 aria-controls=card8-body>Contributing a Module</button><div class=body aria-labelledby=card8 role=region id=card8-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card8></ul></div></div></div></nav></div></div><div class="col-12 col-md-9"><nav aria-label=Breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://ibm.github.io/the-mesh-for-data/>Mesh for Data</a></li><li class=breadcrumb-item><a href=https://ibm.github.io/the-mesh-for-data/contribute/>Contribute</a></li><li class=breadcrumb-item><a href=https://ibm.github.io/the-mesh-for-data/contribute/code/ title="Details how to contribute code changes.">Contributing Code</a></li><li class=breadcrumb-item>Contribution Flow</li></ol></nav><h1 class=title>Contribution Flow</h1><div class="content anchor-link-enabled"><p>This page describes the flow that contributors should follow, including the GitHub workflow and how to build and test the project after making changes.</p><h1 id=issues-and-pull-requests>Issues and Pull Requests</h1><p>Contributing to Mesh for Data is done following the GitHub workflow of Pull Requests.</p><p>You should usually open a pull request in the following situations:</p><ul><li>Start work on a contribution that was already asked for, or that you’ve already discussed, in an issue.</li><li>Submit trivial fixes (for example, a typo, a broken link or an obvious error).</li></ul><p>A pull request doesn’t have to represent finished work. It’s usually better to open a pull request early on, so others can watch or give feedback on your progress. Just mark it as a “WIP” (Work in Progress) in the subject line. You can always add more commits later.</p><p>Here’s how to submit a pull request:</p><ul><li><strong><a href=https://github.com/IBM/the-mesh-for-data/fork>Fork</a></strong> the main repository</li><li><strong>Clone the forked repository locally</strong>. Connect your local to the original “upstream” repository by adding it as a remote.<div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>git clone git@github.com:<span class=k>$(</span>git config user.name<span class=k>)</span>/the-mesh-for-data.git
git remote add upstream https://github.com/IBM/the-mesh-for-data.git
git remote set-url --push upstream no_push
</code></pre></div></li><li><strong><a href=https://help.github.com/articles/syncing-a-fork/>Pull in changes</a></strong> from “upstream” often so that you stay up to date so that when you submit your pull request, merge conflicts will be less likely.<div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>git fetch upstream
git checkout master
git merge upstream/master
git push origin master
</code></pre></div></li><li><strong><a href=https://guides.github.com/introduction/flow/>Create a branch</a></strong> for your edits from master. Note that your should never add edits to the master branch itself.<div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>git checkout -b &lt;branch name&gt;
</code></pre></div></li><li><strong>Make commits of logical units</strong>, ensuring that commit messages are in the <a href=#format-of-the-commit-message>proper format</a>.</li><li><strong>Push your changes</strong> to the created branch in your fork of the repository.</li><li><strong>Open a pull request</strong> to the original repository.</li><li><strong>Reference any relevant issues</strong> or supporting documentation in your PR (for example, “Closes #37.”)</li></ul><p>As always, you must <a href=#normalize-the-code>follow code style</a>, ensure that <a href=#building-and-testing>all tests pass</a>, and add any new tests as appropriate.</p><p><strong>Thanks for your contribution!</strong></p><h1 id=building-and-testing>Building and testing</h1><p><a href=../devenv>Setup a development environment</a> and make sure <code>make install-tools</code> finished successfully.</p><p>Build and run unit tests with:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>make build
make <span class=nb>test</span>
</code></pre></div><p>Some tests for controllers are written in a fashion that they can be run on a simulated environment using
<a href=https://godoc.org/github.com/kubernetes-sigs/controller-runtime/pkg/envtest>testEnv</a> or on an already existing
Kubernetes cluster (or local kind cluster). The default is to use testEnv. In order to run the tests in a local cluster
the following environment variables can be set.:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>NO_SIMULATED_PROGRESS</span><span class=o>=</span><span class=nb>true</span> <span class=nv>USE_EXISTING_CLUSTER</span><span class=o>=</span><span class=nb>true</span> make -C manager <span class=nb>test</span>
</code></pre></div><p>Please be aware that the controller is running locally in this case! If a controller is already deployed onto the
cluster then the tests can be run with the command below. This will ensure that the tests are only creating CRDs on
the cluster and checking their status.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>USE_EXISTING_CONTROLLER</span><span class=o>=</span><span class=nb>true</span> <span class=nv>NO_SIMULATED_PROGRESS</span><span class=o>=</span><span class=nb>true</span> <span class=nv>USE_EXISTING_CLUSTER</span><span class=o>=</span><span class=nb>true</span> make -C manager <span class=nb>test</span>
</code></pre></div><ul><li>USE_EXISTING_CLUSTER: (true/false)
This variable controls if an existing K8s cluster should be used or not.
If not testEnv will spin up an artificial environment that includes a local etcd setup.</li><li>NO_SIMULATED_PROGRESS: (true/false)
This variable can be used by tests that can manually simulate progress of e.g. jobs or pods.
e.g. the simulated test environment from testEnv does not progress pods etc while when testing against
an external Kubernetes cluster this will actually run pods.</li><li>USE_EXISTING_CONTROLLER: (true/false)
This setting controls if a controller should be set up and run by this test suite or if an external one
should be used. E.g. in integration tests running against an existing setup a controller is already existing
in the Kubernetes cluster and should not be started by the test as two controllers competing may influence the test.</li></ul><h1 id=running-integration-tests>Running integration tests</h1><h2 id=running-in-one-step>Running in one step</h2><p>With the following you will then setup a kind cluster with the local registry,
build and push current docker images and finally run the integration
tests on it:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>make run-integration-tests
</code></pre></div><h2 id=running-step-by-step>Running step by step</h2><p>It is also possible to call the commands step by step, which sometimes is
useful if you want to only repeat a specific step which failed without having
to rerun the entire sequence</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># use the local kind registry</span>
<span class=nb>export</span> <span class=nv>DOCKER_HOSTNAME</span><span class=o>=</span>kind-registry:5000
<span class=nb>export</span> <span class=nv>DOCKER_NAMESPACE</span><span class=o>=</span>m4d-system

<span class=c1># build a local kind cluser</span>
make kind

<span class=c1># deploy the the cluster 3rd party such as cert-manager and vault</span>
make cluster-prepare

<span class=c1># build all docker images and push them to the local registry</span>
make docker

<span class=c1># build the mock/test docker images and push them to local registry</span>
make -C test/services docker-build docker-push

<span class=c1># wait until cluster-prepare setup really completed</span>
make cluster-prepare-wait

<span class=c1># init vault for the secret-provider</span>
make -C secret-provider configure-vault

<span class=c1># deploy the secret-provider service to the kind cluster</span>
make -C secret-provider deploy

<span class=c1># deploy the m4d CRDs to the kind cluster</span>
make -C manager deploy-crd

<span class=c1># deploy m4d manager to the kind cluster</span>
make -C manager deploy_it

<span class=c1># wait until manager is ready</span>
make -C manager wait_for_manager

<span class=c1># build and push helm charts to the local registry</span>
make helm

<span class=c1># actually run the integration tests</span>
make -C manager run-integration-tests
</code></pre></div><h1 id=building-in-a-multi-cluster-environment>Building in a multi cluster environment</h1><p>As Mesh for Data can run in a multi-cluster environment there is also a test environment
that can be used that simulates this scenario. Using kind one can spin up two separate kubernetes
clusters with differnt contexts and develop and test in these.</p><p>Two kind clusters that share the same kind-registry can be set up using:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>make kind-setup-multi
</code></pre></div><h1 id=normalize-the-code>Normalize the code</h1><p>To ensure the code is formatted uniformly we use various linters which are
invoked using</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>make verify
</code></pre></div><h1 id=format-of-the-commit-message>Format of the Commit Message</h1><p>The project follows a rough convention for commit messages that is designed to answer two questions: what changed and why.
The subject line should feature the what and the body of the commit should describe the why.</p><p>Every commit must also include a DCO Sign Off at the end of the commit message. By doing this you state that you certify the <a href=https://developercertificate.org/>Developer Certificate of Origin</a>. This can be automated by adding the <code>-s</code> flag to <code>git commit</code>. You can also mass sign-off a whole PR with <code>git rebase --signoff master</code>.</p><p>Example commit message:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>scripts: add the test-cluster command

this uses tmux to setup a test cluster that you can easily kill and
start for debugging.

Fixes #38

Signed-off-by: Legal Name &lt;your.email@example.com&gt;
</code></pre></div><p>The format can be described more formally as follows:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;subsystem&gt;: &lt;what changed&gt;
&lt;BLANK LINE&gt;
&lt;why this change was made&gt;
&lt;BLANK LINE&gt;
&lt;footer&gt;
&lt;BLANK LINE&gt;
&lt;signoff&gt;
</code></pre></div><p>The first line is the subject and should be no longer than 70 characters, the second line is always blank, and other lines should be wrapped at 80 characters.
This allows the message to be easier to read on GitHub as well as in various git tools.</p></div></div></div></div></div></div><div class=sub-footer><div class=container><div class=row><div class=col-12><div class=sub-footer-inner><ul><li class=fineprint><a href=https://ibm.github.io/the-mesh-for-data/legal>fine print</a></li></ul></div></div></div></div></div><script type=text/javascript src=/the-mesh-for-data/js/scripts.min.743d9793278e564da4ce594a32a52b65cbd1df69adbfc11858d0093e9a230182.js></script></body></html>