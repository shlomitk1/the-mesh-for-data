<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Contributing a Module - Mesh for Data</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://ibm.github.io/the-mesh-for-data/favicon.png><link rel=stylesheet href=/the-mesh-for-data/css/style.min.3dea6367d70c56e79acec88bd5217c58299cb81f7dd3f7a663517f3f971ab627.css></head><body class="page page-default-single"><div id=main-menu-mobile class=main-menu-mobile><ul><li class=menu-item-home><a href=/the-mesh-for-data/><span>Home</span></a></li><li class=menu-item-docs><a href=/the-mesh-for-data/docs/><span>Docs</span></a></li><li class=menu-item-contribute><a href=/the-mesh-for-data/contribute/><span>Contribute</span></a></li></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=https://ibm.github.io/the-mesh-for-data/><img alt=Logo src=/the-mesh-for-data/images/logo.svg></a></div><div class=logo-mobile><a href=https://ibm.github.io/the-mesh-for-data/><img alt=Logo src=/the-mesh-for-data/images/logo.svg></a></div><div id=main-menu class=main-menu><ul><li class=menu-item-home><a href=/the-mesh-for-data/><span>Home</span></a></li><li class=menu-item-docs><a href=/the-mesh-for-data/docs/><span>Docs</span></a></li><li class=menu-item-contribute><a href=/the-mesh-for-data/contribute/><span>Contribute</span></a></li><li><a href=https://github.com/IBM/the-mesh-for-data style=color:#000 class=border-left><i class="fab fa-github fa-2x"></i></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pt-md-6 pb-3 pb-md-6"><div class=row><div class="col-12 col-md-3 mb-3"><div class="d-none d-lg-block"><nav id=sidebar aria-label="Section Navigation"><div class=directory><div class=card><button class="header dynamic" id=card4 title="Details how to contribute code changes." aria-controls=card4-body>Contributing Code</button><div class=body aria-labelledby=card4 role=region id=card4-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card4><li role=none><a role=treeitem href=https://ibm.github.io/the-mesh-for-data/contribute/code/flow/>Contribution Flow</a></li><li role=none><a role=treeitem href=https://ibm.github.io/the-mesh-for-data/contribute/code/devenv/>Development Environment</a></li></ul></div></div><div class=card><button class="header dynamic" id=card6 title="Details how to create and maintain documentation pages." aria-controls=card6-body>Contributing Docs</button><div class=body aria-labelledby=card6 role=region id=card6-body><ul role=tree aria-expanded=true aria-labelledby=card6><li role=none><a role=treeitem title=() href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/workflow/>Contribution Workflow</a></li><li role=treeitem aria-label="Write documentation"><button aria-hidden=true></button><a title="Details how to contribute new documentation ()" href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/>Write documentation</a><ul role=group aria-expanded=false class=leaf-section><li role=none><a role=treeitem title="Documentation syntax is Markdown with a few extras ()" href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/syntax/>Documentation Syntax</a></li><li role=none><a role=treeitem title="Explains the standard markup used to format documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/formatting/>Formatting Standards</a></li><li role=none><a role=treeitem title="Explains the style conventions used in the documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/style-guide/>Style Guide</a></li><li role=none><a role=treeitem title="Explains the terminology standards used in the documentation." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/write/terminology/>Terminology Standards</a></li></ul></li><li role=none><a role=treeitem title="Explains how to locally build, test, serve, and preview the website." href=https://ibm.github.io/the-mesh-for-data/contribute/documentation/build/>Preview website locally</a></li></ul></div></div><div class=card><button class="header dynamic" id=card8 aria-controls=card8-body>Contributing a Module</button><div class=body aria-labelledby=card8 role=region id=card8-body><ul role=tree aria-expanded=true class=leaf-section aria-labelledby=card8></ul></div></div></div></nav></div></div><div class="col-12 col-md-9"><nav aria-label=Breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://ibm.github.io/the-mesh-for-data/>Mesh for Data</a></li><li class=breadcrumb-item><a href=https://ibm.github.io/the-mesh-for-data/contribute/>Contribute</a></li><li class=breadcrumb-item>Contributing a Module</li></ol></nav><h1 class=title>Contributing a Module</h1><div class="content anchor-link-enabled"><p>This page describes what must be provided when contributing a <a href=https://ibm.github.io/the-mesh-for-data/docs/overview/modules/>module</a>.</p><p>Steps for creating a module:</p><ol><li>Implement the logic of the module you are contributing. The implementation can either be directly in the <a href=#module-workload>Module Workload</a> or in an external component. If the logic is in an external component, then the module workload should act as a client - i.e. receiving paramaters from the control plane and passing them to the external component.</li><li>Create and publish the <a href=#module-helm-chart>Module Helm Chart</a> that will be used by the control plane to deploy the module workload, update it, and delete it as necessary.</li><li>Create the <a href=#m4dmodule-yaml>M4DModule YAML</a> which describes the capabilities of the module workload, in which flows it should be considered for inclusion, its supported interfaces, and the link to the module helm chart.</li><li><a href=#test>Test</a> the new module</li></ol><p>These steps are described in the following sections in more detail, so that you can create your own modules for use by Mesh for Data. Note that a new module is maintained in its own git repository, separate from the <a href=https://github.com/IBM/the-mesh-for-data>the-mesh-for-data</a> repository.</p><h2 id=module-workload>Module Workload</h2><p>The module workload is associated with a specific user workload and is deployed by the control plane. It may implement the logic required itself, or it may be a client interface to an external component.</p><h3 id=credential-management>Credential management</h3><p>Modules that access or write data need credentials in order to access the data store. Rather than pass them between components, the control plane stores the credentials in an internal credential management system and passes to the module a link to the credentials. The module must call the control plane&rsquo;s internal credential management interface, known as the Secret Provider, using the API described in <a href=https://github.com/IBM/the-mesh-for-data/blob/master/secret-provider/README.md>secret-provider/README.md</a>.</p><h2 id=module-helm-chart>Module Helm Chart</h2><p>For any module chosen by the control plane to be part of the data path, the control plane needs to be able to install/remove/upgrade an instance of the module. Mesh for Data uses <a href=https://helm.sh/docs/intro/using_helm/>Helm</a> to provide this functionality. Follow the Helm <a href=https://helm.sh/docs/chart_template_guide/getting_started/>getting started</a> guide if you are unfamiliar with Helm. Note that Helm 3.3 or above is required.</p><p>Because the chart is installed by the control plane, the input <code>values</code> to the chart must match the relevant type of <a href=https://ibm.github.io/the-mesh-for-data/docs/reference/api/generated/app/#k8s-api-github-com-ibm-the-mesh-for-data-manager-apis-app-v1alpha1-modulearguments>ModuleArguments</a>.</p><p>If the module workload needs to return information to the user, that information should be written to the <code>NOTES.txt</code> of the helm chart.</p><p>For a full example see the <a href=https://github.com/IBM/the-mesh-for-data-flight-module/tree/cd168bb6cdf666c2ec1df960395c0dc1c8feeaa9/helm/afm>Arrow Flight Module chart</a>.</p><h3 id=publishing-the-helm-chart>Publishing the Helm Chart</h3><p>Once your Helm chart is ready, you need to push it to a <a href=https://helm.sh/docs/topics/registries/>OCI-based registry</a> such as <a href=https://ghcr.io>ghcr.io</a>. This allows the control plane of Mesh for Data to later pull the chart whenever it needs to be installed.</p><p>You can use the <a href=https://github.com/IBM/the-mesh-for-data/blob/master/hack/make-rules/helm.mk>hack/make-rules/helm.mk</a> Makefile, or manually push the chart:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nv>HELM_EXPERIMENTAL_OCI</span><span class=o>=</span><span class=m>1</span> 
helm registry login -u &lt;username&gt; &lt;registry&gt;
helm chart save &lt;chart folder&gt; &lt;registry&gt;/&lt;path&gt;:&lt;version&gt;
helm chart push &lt;registry&gt;/&lt;path&gt;:&lt;version&gt;
</code></pre></div><h2 id=m4dmodule-yaml>M4DModule YAML</h2><p><code>M4DModule</code> is a kubernetes Custom Resource Definition (CRD) which describes to the control plane the functionality provided by the module. The M4DModule CRD has no controller. The specification of the <code>M4DModule</code> Kubernetes CRD is available in the <a href=https://ibm.github.io/the-mesh-for-data/docs/reference/api/generated/app/#k8s-api-github-com-ibm-the-mesh-for-data-manager-apis-app-v1alpha1-m4dmodule>API documentation</a>.</p><p>The YAML file begins with standard Kubernetes metadata followed by the <code>M4DModule</code> specification:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>app.m4d.ibm.com/v1alpha1<span class=w> </span><span class=c># always this value</span><span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>M4DModule<span class=w> </span><span class=c># always this value</span><span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;module name&gt;&#34;</span><span class=w> </span><span class=c># the name of your new module</span><span class=w>
</span><span class=w>  </span><span class=k>namespace</span><span class=p>:</span><span class=w> </span>m4d-system<span class=w>  </span><span class=c># control plane namespace. Always m4d-system</span><span class=w>
</span><span class=w></span><span class=k>spec</span><span class=p>:</span><span class=w>
</span><span class=w>   </span>...<span class=w>
</span></code></pre></div><p>The child fields of <code>spec</code> are described next.</p><h3 id=specchart><code>spec.chart</code></h3><p>This is a link to a the Helm chart stored in the <a href=https://helm.sh/docs/topics/registries/>image registry</a>. This is similar to how a Kubernetes <code>Pod</code> references a container image. See <a href=#module-helm-chart>Module Helm chart</a> for more details.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>spec:
  chart: &#34;&lt;helm chart link&gt;&#34; # e.g.: ghcr.io/username/chartname:chartversion
</code></pre></div><h3 id=specstatusindicators><code>spec.statusIndicators</code></h3><p>Used for tracking the status of the module in terms of success or failure. In many cases this can be omitted and the status will be detected automatically.</p><p>if the Helm chart includes standard Kubernetes resources such as Deployment and Service, then the status is automatically detected. If however Custom Resource Definitions are used, then the status may not be automatically detected and statusIndicators should be specified.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>statusIndicators</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>kind</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;module name&gt;&#34;</span><span class=w>
</span><span class=w>      </span><span class=k>successCondition</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;condition&gt;&#34;</span><span class=w> </span><span class=c># ex: status.status == SUCCEEDED</span><span class=w>
</span><span class=w>      </span><span class=k>failureCondition</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;condition&gt;&#34;</span><span class=w> </span><span class=c># ex: status.status == FAILED</span><span class=w>
</span><span class=w>      </span><span class=k>errorMessage</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&lt;field path&gt;&#34;</span><span class=w> </span><span class=c># ex: status.error</span><span class=w>
</span></code></pre></div><h3 id=specdependencies><code>spec.dependencies</code></h3><p>A dependency has a <code>type</code> and a <code>name</code>. Currently <code>dependencies</code> of type <code>module</code> are supported, indicating that another module must also be installed for this module to work.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>dependencies</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>type</span><span class=p>:</span><span class=w> </span>module<span class=w> </span><span class=c>#currently the only option is a dependency on another module deployed by the control plane</span><span class=w>
</span><span class=w>      </span><span class=k>name</span><span class=p>:</span><span class=w> </span>&lt;dependent<span class=w> </span>module<span class=w> </span>name&gt;<span class=w>
</span></code></pre></div><h3 id=specflows><code>spec.flows</code></h3><p>The <code>flows</code> field indicates the types of capabilities supported by the module. Currently supported are three data flows: <code>read</code> for enabling an application to read data or prepare data for being read, <code>write</code> for enabling an application to write data, and <code>copy</code> for performing an implicit data copy on behalf of the application. A module is associated with one or more data flow based on its functionality.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>flows</span><span class=p>:</span><span class=w> </span><span class=c># Indicate the data flow(s) in which the control plane should consider using this module </span><span class=w>
</span><span class=w></span>- read<span class=w>  </span><span class=c># optional</span><span class=w>
</span><span class=w></span>- write<span class=w> </span><span class=c># optional</span><span class=w>
</span><span class=w></span>- copy<span class=w>  </span><span class=c># optional</span><span class=w>
</span></code></pre></div><h3 id=speccapabilities><code>spec.capabilities</code></h3><p><code>capabilites.credentials-managed-by</code> may be either <code>secret-provider</code> or <code>automatic</code>. Currently only <code>secret-provider</code> is supported, meaning that the module will receive a link to the data set credentials and must use the Secret Provider API to obtain the credentials.
TODO: Add API link</p><p><code>capabilites.supportedInterfaces</code> lists the supported data services from which the module can read data and to which it can write</p><ul><li><code>flow</code> field can be <code>read</code>, <code>write</code> or <code>copy</code></li><li><code>protocol</code> field can take a value such as <code>kafka</code>, <code>s3</code>, <code>jdbc-db2</code>, <code>m4d-arrow-flight</code>, etc.</li><li><code>format</code> field can take a value such as <code>avro</code>, <code>parquet</code>, <code>json</code>, or <code>csv</code>.
Note that a module that targets copy flows will omit the <code>api</code> field and contain just <code>source</code> and <code>sink</code>, a module that only supports reading data assets will omit the <code>sink</code> field and only contain <code>api</code> and <code>source</code></li></ul><p><code>capabilites.api</code> indicates the protocol and data format supported for reading or writing data from the user&rsquo;s workload.</p><p>An example for a module that copies data from a db2 database table to an s3 bucket in parquet format.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>capabilities</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>credentials-managed-by</span><span class=p>:</span><span class=w> </span>secret-provider<span class=w>
</span><span class=w>    </span><span class=k>supportedInterfaces</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>flow</span><span class=p>:</span><span class=w> </span>copy<span class=w>  
</span><span class=w>      </span><span class=k>source</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>jdbc-db2<span class=w>
</span><span class=w>        </span><span class=k>dataformat</span><span class=p>:</span><span class=w> </span>table<span class=w>
</span><span class=w>      </span><span class=k>sink</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>s3<span class=w>
</span><span class=w>        </span><span class=k>dataformat</span><span class=p>:</span><span class=w> </span>parquet<span class=w>
</span></code></pre></div><p>An example for a module that has an API for reading data, and supports reading both parquet and csv formats from s3.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>capabilities</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>credentials-managed-by</span><span class=p>:</span><span class=w> </span>secret-provider<span class=w>
</span><span class=w>    </span><span class=k>api</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>m4d-arrow-flight<span class=w>
</span><span class=w>      </span><span class=k>dataformat</span><span class=p>:</span><span class=w> </span>arrow<span class=w>
</span><span class=w>    </span><span class=k>supportedInterfaces</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>flow</span><span class=p>:</span><span class=w> </span>read<span class=w>
</span><span class=w>      </span><span class=k>source</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>s3<span class=w>
</span><span class=w>        </span><span class=k>dataformat</span><span class=p>:</span><span class=w> </span>parquet<span class=w>
</span><span class=w>    </span>- <span class=k>flow</span><span class=p>:</span><span class=w> </span>read<span class=w>
</span><span class=w>      </span><span class=k>source</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>protocol</span><span class=p>:</span><span class=w> </span>s3<span class=w>
</span><span class=w>        </span><span class=k>dataformat</span><span class=p>:</span><span class=w> </span>csv<span class=w>
</span></code></pre></div><p><code>capabilites.actions</code> are taken from a defined <a href=about:blank>Enforcement Actions Taxonomy</a>
a module that does not perform any transformation on the data may omit the <code>capabilities.actions</code> field.</p><p>The following is an example of how a module would declare that it knows how to redact, remove or encrypt data. For each action there is a level indication, which can be data set level, column level, or row level. In the example shown column level is indicated, and the actions arguments indicate the columns on which the transformation should be performed.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>capabilities</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>actions</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=k>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redact-ID&#34;</span><span class=w>
</span><span class=w>      </span><span class=k>level</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=c># column</span><span class=w>
</span><span class=w>      </span><span class=k>args</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>column_name</span><span class=p>:</span><span class=w> </span>column_value<span class=w>
</span><span class=w>    </span>- <span class=k>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;removed-ID&#34;</span><span class=w>
</span><span class=w>      </span><span class=k>level</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=c># column</span><span class=w>
</span><span class=w>      </span><span class=k>args</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>column_name</span><span class=p>:</span><span class=w> </span>column_value<span class=w>
</span><span class=w>    </span>- <span class=k>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;encrypt-ID&#34;</span><span class=w>
</span><span class=w>      </span><span class=k>level</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=c># column</span><span class=w>
</span></code></pre></div><h3 id=full-examples>Full Examples</h3><p>The following are examples of YAMLs from fully implemented modules:</p><ul><li>An example YAML for a module that <a href=https://github.com/IBM/the-mesh-for-data/blob/master/manager/testdata/e2e/module-implicit-copy-db2wh-to-s3.yaml>copies from db2 to s3</a> and includes transformation actions</li><li>And an example <a href=https://github.com/IBM/the-mesh-for-data-flight-module/blob/master/module.yaml>arrow flight read module</a> YAML, also with transformation support</li></ul><h2 id=test>Test</h2><ol><li><a href=https://ibm.github.io/the-mesh-for-data/docs/overview/modules#registering-a-module>Register the module</a> to make the control plane aware of it.</li><li>Create an <code>M4DApplication</code> YAML for a user workload, ensuring that the data set and other parameters included in it, together with the governance policies defined in the policy manager, will result in your module being chosen based on the <a href=https://ibm.github.io/the-mesh-for-data/docs/overview/modules#control-plane-choice-of-modules>control plane logic</a>.</li><li>Apply the <code>M4DApplication</code> YAML.</li><li>View the <code>M4DApplication status</code>.</li><li>Run the user workload and review the results to check if they are what is expected.</li></ol></div></div></div></div></div></div><div class=sub-footer><div class=container><div class=row><div class=col-12><div class=sub-footer-inner><ul><li class=fineprint><a href=https://ibm.github.io/the-mesh-for-data/legal>fine print</a></li></ul></div></div></div></div></div><script type=text/javascript src=/the-mesh-for-data/js/scripts.min.743d9793278e564da4ce594a32a52b65cbd1df69adbfc11858d0093e9a230182.js></script></body></html>